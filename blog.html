<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Research Blog</title>
  <style>
    :root{
      --fg:#111; --bg:#fff; --muted:#666; --accent:#182B49; --accent-hover:#C69214; --accent2:#C69214; --card:#f6f7f9;
      --max: 48rem;
    }
    @media (prefers-color-scheme: dark){
      :root{ --fg:#e7e7e7; --bg:#0b0c0f; --muted:#9aa0a6; --accent:#3B7EA1; --accent-hover:#FFCD00; --accent2:#FFCD00; --card:#111318; }
    }
    html,body{height:100%}
    body{margin:0; font:16px/1.6 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; color:var(--fg); background:var(--bg);} 
    a{color:var(--accent); text-decoration:underline; font-weight:500}
    a:hover{color:var(--accent-hover); text-decoration:underline; background:color-mix(in srgb, var(--accent2) 20%, transparent); border-radius:4px;}
    header{position:sticky; top:0; backdrop-filter:saturate(1.2) blur(6px); background:color-mix(in srgb, var(--bg) 80%, transparent); border-bottom:3px solid var(--accent2)}
    .wrap{max-width:var(--max); margin:auto; padding:1rem}
    .brand{font-weight:700; letter-spacing:.2px; color:var(--accent)}
    .grid{display:grid; gap:1rem}
    .post-card{padding:1rem; border-radius:14px; background:var(--card); border:1px solid color-mix(in srgb, var(--fg) 6%, transparent)}
    .post-card h2{margin:.2rem 0 .3rem 0; font-size:1.15rem; color:var(--accent)}
    .muted{color:var(--muted); font-size:.9rem}
    .content{max-width:var(--max); margin:auto; padding:1.2rem}
    .content img{max-width:100%; height:auto; border:2px solid var(--accent2); border-radius:8px; margin:0.5rem 0}
    .content pre{overflow:auto; padding:1rem; border-radius:12px; background:#0b1020; color:#e7e7e7}
    .content code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .list-empty{padding:2rem; text-align:center; color:var(--muted)}
    footer{border-top:3px solid var(--accent2); margin-top:2rem; color:var(--accent2)}
    .srch{display:flex; gap:.5rem; align-items:center}
    .srch input{flex:1; padding:.6rem .8rem; border-radius:12px; border:1px solid color-mix(in srgb, var(--fg) 12%, transparent); background:var(--bg); color:var(--fg)}
    .chip{display:inline-block; padding:.15rem .5rem; border-radius:999px; background:var(--accent2); color:#fff; font-size:.8rem}
    .toc{border-left:3px solid var(--accent); padding-left:.8rem; margin:.5rem 0 1rem 0}
    .back{display:inline-flex; align-items:center; gap:.4rem; color:var(--accent)}
  </style>
  <!-- Markdown parser via CDN (tiny, zero build) -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex; gap:1rem; align-items:center; justify-content:space-between">
      <a class="brand" href="#">My Markdown Blog</a>
      <nav><a href="#">Home</a></nav>
    </div>
  </header>

  <main id="app" class="wrap" style="min-height:60vh">
    <!-- content injected here -->
  </main>

  <footer>
    <div class="wrap muted">Purely client-side, vibe-coded using ChatGPT.</div>
  </footer>

  <script>
 // --- Minimal client-side blog ---
  // HOW IT WORKS
  // 1) You maintain /posts/posts.json that lists your markdown files.
  // 2) Each .md can optionally include simple front‑matter lines like:
  //    Title: My Post Title\nDate: 2025-08-01\nTags: notes, demo\n\n# Heading ...
  // 3) This file renders the index (list) and a post view (#/post/<slug>).

    const CONFIG = {
    title: "My Markdown Blog",
    postsIndex: "posts/posts.json",
    postsBase: "posts/",
    enableSearch: true
  };

  const $ = sel => document.querySelector(sel);
  const app = $("#app");

  const fmtDate = s => {
    if(!s) return ""; const d = new Date(s); if(isNaN(d)) return s; return d.toLocaleDateString(undefined, {year:'numeric', month:'short', day:'numeric'});
  };

  function parseFrontMatter(md){
    const lines = md.split(/\r?\n/);
    let meta = { title:"", date:"", tags:[] }, i = 0;
    while(i < lines.length){
      const line = lines[i].trim();
      if(line === "") { i++; break; }
      const m = line.match(/^(Title|Date|Tags)\s*:\s*(.*)$/i);
      if(!m) break;
      const key = m[1].toLowerCase();
      const val = m[2].trim();
      if(key === 'title') meta.title = val;
      else if(key === 'date') meta.date = val;
      else if(key === 'tags') meta.tags = val.split(',').map(s=>s.trim()).filter(Boolean);
      i++;
    }
    return meta;
  }

  async function fetchJSON(url){
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error("Failed to load " + url);
    return res.json();
  }
  async function fetchText(url){
    const res = await fetch(url, {cache:'no-store'});
    if(!res.ok) throw new Error("Failed to load " + url);
    return res.text();
  }

  function setTitle(t){ document.title = t ? t + " • " + CONFIG.title : CONFIG.title; $(".brand").textContent = CONFIG.title; }

  function renderList(posts, q=""){
    setTitle("");
    const filtered = q ? posts.filter(p => (
      (p.title||"").toLowerCase().includes(q) ||
      (p.tags||[]).join(" ").toLowerCase().includes(q) ||
      (p.slug||"").toLowerCase().includes(q)
    )) : posts;

    app.innerHTML = `
      <div class="grid" style="gap:1rem">
        ${CONFIG.enableSearch ? `
        <div class="srch">
          <input id="q" placeholder="Search posts..." value="${q.replace(/"/g,'&quot;')}">
          <span class="chip">${filtered.length} / ${posts.length}</span>
        </div>` : ''}
        <div id="list" class="grid">
          ${filtered.length ? filtered.map(p => `
            <article class="post-card">
              <h2><a href="#/post/${encodeURIComponent(p.slug)}">${p.title || p.slug}</a></h2>
              <div class="muted">${fmtDate(p.date)}${p.tags?.length?` • ${p.tags.map(t=>`<span class="chip">${t}</span>`).join(' ')}`:''}</div>
            </article>
          `).join("") : `<div class="list-empty">No posts found.</div>`}
        </div>
      </div>`;

    const qInput = $("#q");
    if(qInput){
      qInput.addEventListener('input', (e)=>{
        const val = e.target.value.trim().toLowerCase();
        renderList(posts, val);
      });
      qInput.focus();
    }
  }

  async function renderPost(posts, slug){
    const entry = posts.find(p => p.slug === slug);
    if(!entry){ app.innerHTML = `<p>Post not found. <a href="#">Back</a></p>`; return; }
    const md = await fetchText(CONFIG.postsBase + entry.file);
    const meta = parseFrontMatter(md);
    const title = meta.title || entry.title || entry.slug;

    setTitle(title);

    const html = marked.parse(md.replace(/^Title:.*\n|^Date:.*\n|^Tags:.*\n/gmi, ""));

    app.innerHTML = `
      <p><a class="back" href="#">← Back</a></p>
      <h1 style="margin:.2rem 0 .2rem 0">${title}</h1>
      <div class="muted" style="margin-bottom:1rem">${fmtDate(meta.date || entry.date)}${(meta.tags?.length?meta.tags:entry.tags||[]).length?` • ${(meta.tags?.length?meta.tags:entry.tags||[]).map(t=>`<span class="chip">${t}</span>`).join(' ')}`:''}</div>
      <article class="content">${html}</article>
    `;

    buildTOC();
  }

  function buildTOC(){
    const content = app.querySelector('.content');
    const hs = content ? content.querySelectorAll('h1,h2,h3') : [];
    if(!hs || !hs.length) return;
    hs.forEach(h => {
      if(!h.id){ h.id = h.textContent.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,''); }
    });
    const toc = document.createElement('div');
    toc.className = 'toc';
    toc.innerHTML = '<strong>On this page</strong>' + Array.from(hs).map(h=>{
      return `<div style="margin:.2rem 0 .1rem ${({H1:0,H2:12,H3:24})[h.tagName]}px"><a href="#${h.id}">${h.textContent}</a></div>`;
    }).join('');
    const h1 = app.querySelector('h1');
    if(h1) h1.insertAdjacentElement('afterend', toc);
  }

  async function main(){
    try{
      const posts = await fetchJSON(CONFIG.postsIndex);
      posts.sort((a,b)=> new Date(b.date||0) - new Date(a.date||0));

      async function router(){
        const m = location.hash.match(/^#\/post\/([^?#]+)/);
        if(m){ await renderPost(posts, decodeURIComponent(m[1])); }
        else { renderList(posts); }
      }
      window.addEventListener('hashchange', router);
      router();
    }catch(err){
      app.innerHTML = `<p>Could not load posts index. Ensure <code>${CONFIG.postsIndex}</code> exists.</p><pre>${String(err)}</pre>`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    setTitle("");
    marked.use({ mangle: false, headerIds: true, breaks: true });
    main();
  });
  </script>
</body>
</html>
